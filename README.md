# artix-installation
Artix linux installation process, later to be used to improve the Artix wiki or to create a pdf manual
## Booting Problem

Sometimes it is not possible to select the USB in UEFI setup as the drive to boot from, so it is not easily possible to get into the Artix installation environment. In this case proceed as described in [this answer][grubboot], rewritten here:

* disable the secure boot option in UEFI firmware settings
* press `c` in grub to open the command line
* execute `ls` to list all hard drives

```
grub>ls 
(hd0) (hd0,msdos2) (hd1) (hd1,gpt8) (hd1,gpt7) (hd1,gpt6) (hd1,gpt5) (hd1,gpt4) (hd1,gpt3) (hd1,gpt2) (hd1,gpt1)
```

* find which one is your USB stick. Listing each will give you the drive's size, e.g. `ls (hd0,msdos2)`, also for artix you should see `ARTIX` in the drive's name and the path `(hd0,msdos2)/efi/boot/bootx64.efi` should exist.
* note the uuid of such drive (check with `ls (hd0,msdos2)`)
* type the following commands (replace `4099-DBD9` with your actual uuid):

```
insmod part_gpt
insmod fat
insmod search_fs_uuid
insmod chain
search --fs-uuid --set=root 4099-DBD9
```

* select the efi file to boot from
```
chainloader /efi/boot/bootx64.efi
```

* finally type `boot`


## Artix Live Environment

### Keyboard Layout

List available keyboard layouts:

```
ls -R /usr/share/kbd/keymaps | more
```

Select your favourite one by using its file name, without the `.map.gz` extension, e.g. for Colemak-DH:
```
sudo loadkeys mod-dh-iso-us`
```

This only sets the selected keyboard layout in the current tty and only until reboot. To make the setting permanent, you have to edit `/etc/conf.d/keymaps` in the installed system. It's also useful to set up `/etc/vconsole.conf` - it may look like this: 
```
FONT_MAP=8859-1_to_uni
FONT=lat1-16
KEYMAP=mod-dh-iso-us
```


### Swap
If Artix live environment finds a swap partition when it is booting, it will automatically use it. You will need to turn off swap by `swapoff` if you want to modify or delete the swap partition

### Partition disks
    cfdisk /dev/sda
Create partitions as needed.

#### Partition types
Boot partition must be of type `EFI System`.
Swap partition must be of type `Linux swap`.
All other partitions should be `Linux filesystem`.

### Format disks
Boot partition has to be formatted with FAT32. It cannot be labeled (FAT file system does not support labels):

```
sudo mkfs.fat -F32 /dev/sda1
sudo fatlabel /dev/sda1 BOOT
```

Swap partition is formatted with `mkswap`. Use `-L SWAP` to label it:

    mkswap -L SWAP /dev/sda2

All other partitions should be ext4. Label them with parameter `-L <name>`:

    mkfs.ext4 -L HOME /dev/sda3
    mkfs.ext4 -L ROOT /dev/sda4
    mkfs.ext4 -L DATA /dev/sdb1

You can check your disks and partitions with lsblk (list block) This example setup was generated by lsblk -o `NAME,PARTTYPENAME,FSTYPE,LABEL,TYPE,MOUNTPOINT`:

    NAME   PARTTYPENAME     FSTYPE LABEL   SIZE TYPE MOUNTPOINT
    sda                                  238.5G disk 
    ├─sda1 EFI System       vfat           260M part /boot
    ├─sda2 Linux swap       swap   SWAP     20G part [SWAP]
    ├─sda3 Linux filesystem ext4   HOME     20G part /home
    └─sda4 Linux filesystem ext4   ROOT  198.2G part /
    sdb                                  698.7G disk 
    └─sdb1 Linux filesystem ext4   DATA  698.7G part /data
    sr0                                   1024M rom  

Other convenient opstion is `lsblk -f`, or use `blkid`

### Mount partitions
You will have to create directories for the non-root partitions. 

    mkdir /mnt/boot
    mkdir /mnt/boot/efi
    mkdir /mnt/home
    mkdir /mnt/data

If you have freshly created partitions, you can use their labels when mounting them. Swap partition is not mounted. Just activate it with `swapon` or deactivate with `swapoff`.

    swapon /dev/disk/by-label/SWAP
    mount /dev/disk/by-label/ROOT /mnt
    mount /dev/disk/by-label/HOME /mnt/home
    mount /dev/disk/by-label/BOOT /mnt/boot
    mount /dev/disk/by-label/DATA /mnt/data

If the partitions were not created in this session, they have to be mounted by their device names, `mount /dev/sda1 /mnt/boot` etc. 
### Connect to the internet

A working internet connection is required and assumed. A wired connection is setup automatically, if found. Wireless ones must be configured by the user. Verify your connection and update the repositories:

    ping 8.8.8.8
    pacman -Syy

### Update the system clock

Use your respective init system to start the `ntpd` service, here: dinit

    sudo dinitctl start ntpd

### Install base system

Use `basestrap` to install the `base` and optionally the `base-devel` package groups and your preferred init (currently available: `dinit`, `openrc`, `runit`, and `s6`):

    basestrap /mnt base base-devel dinit elogind-dinit

### Install a kernel

Artix provides `linux-lts` and `linux` kernels. It is possible to experiment with other kernels, e.g. (`-ck`, `-pf`, `-zen`, etc.). Linux-firmware is recommended for recognizing devices (like network card)

    basestrap /mnt linux linux-firmware

### Generate the File System Table

Use fstabgen to generate /etc/fstab, use `-U` for UUIDs or `-L` for partition labels:

    fstabgen -L /mnt > /mnt/etc/fstab

check and verify /etc/fstab. See [ArchWiki/fstab](https://wiki.archlinux.org/index.php/Fstab). It could look like this:

    # /dev/sda4 UUID=16211fe2-0927-4853-af22-b701645183fd
    LABEL=ROOT          	/         	ext4      	rw,relatime	0 1
    
    # /dev/sda3 UUID=f157bfe7-62f4-42b9-af5d-c1541758a11b
    LABEL=HOME          	/home     	ext4      	rw,relatime	0 2
    
    # /dev/sda1 UUID=A891-66B5
    /dev/sda1           	/boot     	vfat      	rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=iso8859-1,shortname=mixed,utf8,errors=remount-ro	0 2
    
    # /dev/sdb1 UUID=0a45d2db-2042-4e2e-a463-a5aef98795e3
    LABEL=DATA          	/data     	ext4      	rw,relatime	0 2
    
    # /dev/sda2 UUID=8a8c0b83-8b6f-4fea-bd4a-905e7b51ebb4
    LABEL=SWAP          	none      	swap      	defaults  	0 0


## Base System Configuration

The base system configuration is done from the future root location. This is _especially_ practical for the boot loader configuration and installation. Therefore change to the new root location:
    artix-chroot /mnt

### Set the system clock

Browse regions and cities in `/usr/share/zoneinfo/`. Then create a symbolic link to your region and city as `/etc/localtime`.

    ln -sf /usr/share/zoneinfo/<Region>/<City> /etc/localtime

Run hwclock to generate /etc/adjtime:

    hwclock --systohc

### Localization

Install a text editor of your choice (let's use vim here) and edit `/etc/locale.gen`, uncommenting the locales you desire:

    pacman -Sy vim
    vim /etc/locale.gen

Then generate your desired locales
    locale-gen

To set the locale systemwide, create or edit `/etc/locale.conf` (which is sourced by `/etc/profile`) or `/etc/bash/bashrc.d/artix.bashrc` or `/etc/bash/bashrc.d/local.bashrc`; user-specific changes may be made to their respective `~/.bashrc`, for example:

    export LANG="en_US.UTF-8"
    export LC_COLLATE="C"

Example `/etc/locale.conf`:

    LANG=en_US.UTF-8
    LC_TIME=en_DK.UTF-8
    LC_PAPER=de_DE.UTF-8
    LC_COLLATE=C

For more info see [ArchWiki/Locale](https://wiki.archlinux.org/index.php/Locale).


### Boot Loader

First, install `grub` and `os-prober` (for detecting other installed operating systems) and EFI boot manager:

    pacman -S grub os-prober efibootmgr

Modify Grub's default settings in `/etc/default/grub` or the configuration generating scripts in `/etc/grub.d/`. See [ArchWiki/GRUB](https://wiki.archlinux.org/index.php/GRUB#Generate_the_main_configuration_file).

Here I added `random.trust_cpu=on` (Arch Forums post [1](https://bbs.archlinux.org/viewtopic.php?id=248132) and [2](https://bbs.archlinux.org/viewtopic.php?pid=1816982#p1816982)) and the UUID of the swap partition to `resume` the system from hiberation. Also I let highlight the last used system to boot (`GRUB_DEFAULT=saved`, `GRUB_SAVEDEFAULT=true`):

    # GRUB boot loader configuration
    
    GRUB_DEFAULT=saved
    GRUB_TIMEOUT=5
    GRUB_DISTRIBUTOR="Artix"
    GRUB_CMDLINE_LINUX_DEFAULT="loglevel=3 random.trust_cpu=on resume=UUID=8a8c0b83-8b6f-4fea-bd4a-905e7b51ebb4 quiet"
    GRUB_CMDLINE_LINUX=""
    
    # Preload both GPT and MBR modules so that they are not missed
    GRUB_PRELOAD_MODULES="part_gpt part_msdos"
    
    # Uncomment to enable booting from LUKS encrypted devices
    #GRUB_ENABLE_CRYPTODISK=y
    
    # Set to 'countdown' or 'hidden' to change timeout behavior,
    # press ESC key to display menu.
    GRUB_TIMEOUT_STYLE=menu
    
    # Uncomment to use basic console
    GRUB_TERMINAL_INPUT=console
    
    # Uncomment to disable graphical terminal
    #GRUB_TERMINAL_OUTPUT=console
    
    # The resolution used on graphical terminal
    # note that you can use only modes which your graphic card supports via VBE
    # you can see them in real GRUB with the command `vbeinfo'
    GRUB_GFXMODE=auto
    
    # Uncomment to allow the kernel use the same resolution used by grub
    GRUB_GFXPAYLOAD_LINUX=keep
    
    # Uncomment if you want GRUB to pass to the Linux kernel the old parameter
    # format "root=/dev/xxx" instead of "root=/dev/disk/by-uuid/xxx"
    #GRUB_DISABLE_LINUX_UUID=true
    
    # Uncomment to disable generation of recovery mode menu entries
    GRUB_DISABLE_RECOVERY=true
    
    # Uncomment and set to the desired menu colors.  Used by normal and wallpaper
    # modes only.  Entries specified as foreground/background.
    GRUB_COLOR_NORMAL="light-blue/black"
    GRUB_COLOR_HIGHLIGHT="light-cyan/blue"
    
    # Uncomment one of them for the gfx desired, a image background or a gfxtheme
    #GRUB_BACKGROUND="/path/to/wallpaper"
    #GRUB_THEME="/path/to/gfxtheme"
    
    # Uncomment to get a beep at GRUB start
    #GRUB_INIT_TUNE="480 440 1"
    
    # Uncomment to make GRUB remember the last selection. This requires
    # setting 'GRUB_DEFAULT=saved' above.
    GRUB_SAVEDEFAULT="true"



Install grub for UEFI boot systems:

    grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=grub

For BIOS boot systems refer to [ArtixWiki/Installation](https://wiki.artixlinux.org/Main/Installation).

Create grub config

    grub-mkconfig -o /boot/grub/grub.cfg

It is paramount that `/boot` contains `initramfs-linux-fallback.img`, `initramfs-linux.img`, `vmlinuz-linux` otherwise it will not boot. Here is my `tree /boot`:

    /boot
    ├── EFI
    │   └── grub
    │       └── grubx64.efi
    ├── grub
    │   ├── fonts
    │   │   └── unicode.pf2
    │   ├── grub.cfg
    │   ├── grubenv
    │   ├── themes
    │   │   └── starfield
    │   │       ├── COPYING.CC-BY-SA-3.0
    ...
    │   │       └── theme.txt
    │   └── x86_64-efi
    │       ├── acpi.mod
    ...
    │       ├── zfs.mod
    │       ├── zfscrypt.mod
    │       ├── zfsinfo.mod
    │       └── zstd.mod
    ├── initramfs-linux-fallback.img
    ├── initramfs-linux.img
    └── vmlinuz-linux
    
    7 directories, 314 files

### Add users

First, set the root passwd:

    passwd

### Change sudoers config

Set vim as the default visudo editor and allow sudo for the wheel group

```
su root
EDITOR=/usr/bin/vim visudo

# Set default EDITOR to vim
Defaults      editor=/usr/bin/vim

# Allow sudo for wheel group
%wheel      ALL=(ALL:ALL) ALL
```

### Add users

Create a regular user (member of wheel) and password:

    useradd -m -G wheel user
    passwd user


### Network Configuration Part 1 (before reboot)

Create a hostname (the network name of the computer), see [ArchWiki/hostname](https://wiki.archlinux.org/index.php/Network_configuration#Set_the_hostname):

    echo coolhostname > /etc/hostname

Install the DHCP client daemon:

    pacman -S dhcpcd

Setup `/etc/hosts`, see [ArchWiki/Domain_name_resolution](https://wiki.archlinux.org/index.php/Domain_name_resolution). Here is an example (columns divided by tabs):

    # Static table lookup for hostnames.
    # See hosts(5) for details.
    127.0.0.1	localhost
    ::1	localhost
    127.0.1.1	lappi.localdomain	lappi

For wireless netowrking, install `connman-dinit` and `wpa_supplicant`. It contains the main program `wpa_supplicant`, the passphrase tool `wpa_passphrase`, and the text front-end `wpa_cli`.

    pacman -S connman-dinit wpa_supplicant

and tell dinit to start it after boot:

    ln -s ../connmand /etc/dinit.d/boot.d/

### Reboot the system

Exit chroot environment:

    exit

Unmount drives:

    umount -R /mnt

Reboot:

    reboot

If everything was right, system will boot and have a wireless internet connection.

## Post-Installation Configuration

### Network Configuration Part 2 (after reboot)

Follow instructions in [ArchWiki/Connman][connman] or in [ArchWiki/Wpa_supplicant][supplicant]. It probably boils down to this:

Start interactive `connman` console by `connmanctl` and do this:

```
technologies
enable wifi
scan wifi
services
agent on
connect wifi_...._managed_psk
```

Once association is complete, you must obtain an IP address, for example, using `dhcpcd` [ArchWiki/Dhcpcd](https://wiki.archlinux.org/index.php/Dhcpcd).

### Change Default Editor For Visudo

Temporarily change the editor of `visudo` to vim:

    export EDITOR="vim"

run `visudo` to edit the `/etc/sudoers` file and add the following lines:

    # Reset environment by default:
    Defaults	env_reset
    # Set default EDITOR to vim, and do not allow visudo to use EDITOR/VISUAL.
    Defaults	editor=/usr/bin/vim, !env_editor

also allow wheel group to run commands:

    # Let users of the "wheel" group run commands.
    %wheel ALL=(ALL) ALL

### Log everything a user does

add this to `/etc/pam.d/system-auth`

```
# log every command executed by a user
session    required                    pam_tty_audit.so     enable=*
```

and then enable `auditd` as a service. `auditd` should already be installed in `/usr/bin/auditd`.

```
sudo pacman -S audit-dinit
sudo dinitctl enable auditd
```

### Install Ulogd2

```
sudo pacman -S ulogd
```

and run it as a process. The service file would look like this:

```
# /etc/dinit.d/ulogd
type            = process
command         = /usr/bin/ulogd --loglevel=debug
smooth-recovery = true
logfile         = /var/log/ulogd.log
after           = network
#pid-file        = /run/ulogd.pid
```

Then create a link in the boot directory `sudo ln -s ../ulogd /etc/dinit.d/boot.d/ulogd`.

### SSH Server

Edit `/etc/ssh/sshd_config`
Set a non-default port `Port <number>`
Disallow Password authentication: `PasswordAuthentication no`
Disable interactive password input (e.g. by keyboard): `KbdInteractiveAuthentication no`
Use PAM `UsePAM yes`
Allow only certain user groups `AllowGroups ssh-users` and add yourself to this usergroup.

The sshd service file would look like this:

```
type            = process
command         = /usr/bin/sshd
smooth-recovery = true
logfile         = /var/log/sshd.log
after           = network
#pid-file        = /run/sshd.pid
```
#### Note on IPv6

There seems to be a bug with ssh to link-local IPv6 addresses: [bugzilla](https://bugzilla.redhat.com/show_bug.cgi?id=829004), [sourceware](https://sourceware.org/bugzilla/show_bug.cgi?id=12377), or maybe it's just my router which is wrongly configured.

### nftables

Nftables is the successor of iptables

### X.org

Install xorg. there's an undergoing cleanup which leads to problems currently (2020-01) and can be resolved by ignoring xorg-server-xdmx:

    pacman -S xorg --ignore xorg-server-xdmx

### Graphics Card

This is currently broken, see [this post](https://forum.artixlinux.org/index.php/topic,6131.0.html).

I have a legacy nvidia card Geforce GTX 675M which is not supported by `nvidia` closed-source drivers. I cannot use the normal nvidia legacy drivers `nvidia-390xx` because Artix uses a custom kernel. Therefore I must install `nvidia-390xx-dkms` which can adapt to custom kernels. 

nvidia-390xx-dkms and nvidia-390xx-utils is now newly in `[galaxy-gremlins]`, [thanks alium](https://forum.artixlinux.org/index.php/topic,1400.msg9766.html#msg9766), so we need to uncomment this in our `/etc/pacman.conf`:

    [galaxy-gremlins]
    Include = /etc/pacman.d/mirrorlist

Also we need `linux-headers`:

    pacman -S linux-headers
    pacman -S nvidia-390xx-dkms nvidia-390xx-settings nvidia-390xx-utils

The dkms drivers are built for the custom kernel everytime the kernel gets reinstalled (thanks to [ArchWiki/Pacman#hooks](https://wiki.archlinux.org/index.php/Pacman#Hooks)). That's why we reinstall the kernel:

	pacman -S linux

After the kernel reinstallation the system needs to be restarted. Before restart, `uname -r` still reports the old kernel version for which the nvidia drivers were not built. After reboot `uname -r` will report the new kernel version and the drivers will work with it.

The nvidia drivers have a configuration tool which creates a primitive configuration file in `/etc/X11/xorg.conf` which can be used to create the real configuration files in `/etc/X11/xorg.conf.d/` (or a custom-set directory). Run the nvidia configuration:

    nvidia-xconfig --xconfig=/root/xorg.conf.new

### X.org Configuration

X.org is configured using an alphabetically sorted series of configuration files in `/etc/X11/xorg.conf.d/`, e.g. `10-server.conf  20-nvidia.conf  30-monitor.conf  40-modules.conf`. The configuration data are distributed among them. The complete configuration data may look like this:

    # cat /etc/X11/xorg.conf.d/*
    # File 10-server.conf
    Section "ServerLayout"
        Identifier     "Manually configured"
        Screen         "Laptop Screen"
        InputDevice    "Mouse0" "CorePointer"
        InputDevice    "Keyboard0" "CoreKeyboard"
    EndSection
    
    Section "InputDevice"
    	Identifier  "Keyboard0"
    	Driver      "kbd"
    EndSection
    
    Section "InputDevice"
    	Identifier  "Mouse0"
    	Driver      "mouse"
    	Option	    "Protocol" "auto"
    	Option	    "Device" "/dev/input/mice"
    	Option	    "ZAxisMapping" "4 5 6 7"
    EndSection
    
    # File 20-nvidia.conf
    Section "Device"
        Identifier     "Nvidia Card"
        Driver         "nvidia"
        VendorName     "NVIDIA Corporation"
    EndSection
    
    # File 30-monitor.conf
    Section "Monitor"
        Identifier     "Laptop LCD"
        VendorName     "Samsung"
        DisplaySize    381 215
    EndSection
    
    Section "Screen"
        Identifier     "Laptop Screen"
        Device         "Nvidia Card"
        Monitor        "Laptop LCD"
        DefaultDepth    24
        SubSection     "Display"
            Modes       "1920x1080"
            Depth       24
        EndSubSection
    EndSection
    
    # File 40-modules.conf
    Section "Module"
        Load           "glx"
    EndSection

### Initialize X

If the graphics card drivers were installed correctly, X should initialize flawlessly:

    xinit

The X GUI can be left by jumping back to `tty1` (press Ctrl-Alt-F1). The running X process can be aborted (Ctrl-C). `/var/log/Xorg.0.log` should show a successful loading of the graphics card drivers, e.g. this:

    [  2739.966] (WW) Failed to open protocol names file lib/xorg/protocol.txt
    [  2739.966]
    X.Org X Server 1.20.8
    X Protocol Version 11, Revision 0
    [  2739.968] Build Operating System: Linux Artix Linux
    [  2739.969] Current Operating System: Linux lappi 5.6.6-artix1-1 #1 SMP PREEMPT Tue, 21 Apr 2020 13:54:16 +0000 x86_64
    [  2739.969] Kernel command line: BOOT_IMAGE=/vmlinuz-linux root=UUID=16211fe2-0927-4853-af22-b701645183fd rw loglevel=3 random.trust_cpu=on resume=UUID=8a8c0b83-8b6f-4fea-bd4a-905e7b51ebb4 quiet
    [  2739.970] Build Date: 30 March 2020  02:12:50PM
    [  2739.971] 
    [  2739.971] Current version of pixman: 0.38.4
    [  2739.972] 	Before reporting problems, check http://wiki.x.org
    	to make sure that you have the latest version.
    [  2739.972] Markers: (--) probed, (**) from config file, (==) default setting,
    	(++) from command line, (!!) notice, (II) informational,
    	(WW) warning, (EE) error, (NI) not implemented, (??) unknown.
    [  2739.974] (==) Log file: "/var/log/Xorg.0.log", Time: Fri Apr 24 11:08:51 2020
    [  2739.975] (==) Using config directory: "/etc/X11/xorg.conf.d"
    [  2739.975] (==) Using system config directory "/usr/share/X11/xorg.conf.d"
    [  2739.975] (==) ServerLayout "Manually configured"
    [  2739.975] (**) |-->Screen "Laptop Screen" (0)
    [  2739.975] (**) |   |-->Monitor "Laptop LCD"
    [  2739.975] (**) |   |-->Device "Nvidia Card"
    [  2739.976] (**) |-->Input Device "Mouse0"
    [  2739.976] (**) |-->Input Device "Keyboard0"
    [  2739.976] (==) Automatically adding devices
    [  2739.976] (==) Automatically enabling devices
    [  2739.976] (==) Automatically adding GPU devices
    [  2739.976] (==) Automatically binding GPU devices
    [  2739.976] (==) Max clients allowed: 256, resource mask: 0x1fffff
    [  2739.976] (WW) `fonts.dir' not found (or not valid) in "/usr/share/fonts/misc".
    [  2739.976] 	Entry deleted from font path.
    [  2739.976] 	(Run 'mkfontdir' on "/usr/share/fonts/misc").
    [  2739.976] (WW) The directory "/usr/share/fonts/TTF" does not exist.
    [  2739.976] 	Entry deleted from font path.
    [  2739.976] (WW) The directory "/usr/share/fonts/OTF" does not exist.
    [  2739.976] 	Entry deleted from font path.
    [  2739.976] (WW) The directory "/usr/share/fonts/Type1" does not exist.
    [  2739.976] 	Entry deleted from font path.
    [  2739.976] (==) FontPath set to:
    	/usr/share/fonts/100dpi,
    	/usr/share/fonts/75dpi
    [  2739.976] (==) ModulePath set to "/usr/lib/xorg/modules"
    [  2739.976] (WW) Hotplugging is on, devices using drivers 'kbd', 'mouse' or 'vmmouse' will be disabled.
    [  2739.976] (WW) Disabling Mouse0
    [  2739.976] (WW) Disabling Keyboard0
    [  2739.976] (II) Module ABI versions:
    [  2739.976] 	X.Org ANSI C Emulation: 0.4
    [  2739.976] 	X.Org Video Driver: 24.1
    [  2739.976] 	X.Org XInput driver : 24.1
    [  2739.976] 	X.Org Server Extension : 10.0
    [  2739.977] (--) using VT number 7
    
    [  2739.977] (II) systemd-logind: logind integration requires -keeptty and -keeptty was not provided, disabling logind integration
    [  2739.977] (II) xfree86: Adding drm device (/dev/dri/card0)
    [  2739.978] (**) OutputClass "nvidia" ModulePath extended to "/usr/lib/nvidia/xorg,/usr/lib/xorg/modules,/usr/lib/xorg/modules"
    [  2739.979] (--) PCI:*(1@0:0:0) 10de:1212:144d:c0d0 rev 161, Mem @ 0xf6000000/16777216, 0xec000000/67108864, 0xf0000000/33554432, I/O @ 0x0000e000/128, BIOS @ 0x????????/131072
    [  2739.979] (WW) Open ACPI failed (/var/run/acpid.socket) (No such file or directory)
    [  2739.979] (II) "glx" will be loaded. This was enabled by default and also specified in the config file.
    [  2739.979] (II) LoadModule: "glx"
    [  2739.979] (II) Loading /usr/lib/nvidia/xorg/libglx.so
    [  2739.982] (II) Module glx: vendor="NVIDIA Corporation"
    [  2739.982] 	compiled for 4.0.2, module version = 1.0.0
    [  2739.982] 	Module class: X.Org Server Extension
    [  2739.982] (II) NVIDIA GLX Module  390.132  Fri Nov  1 04:00:46 PDT 2019
    [  2739.982] (II) LoadModule: "nvidia"
    [  2739.982] (II) Loading /usr/lib/xorg/modules/drivers/nvidia_drv.so
    [  2739.982] (II) Module nvidia: vendor="NVIDIA Corporation"
    [  2739.982] 	compiled for 4.0.2, module version = 1.0.0
    [  2739.982] 	Module class: X.Org Video Driver
    [  2739.982] (II) NVIDIA dlloader X Driver  390.132  Fri Nov  1 03:36:28 PDT 2019
    [  2739.982] (II) NVIDIA Unified Driver for all Supported NVIDIA GPUs
    [  2739.983] (II) Loading sub module "fb"
    [  2739.983] (II) LoadModule: "fb"
    [  2739.984] (II) Loading /usr/lib/xorg/modules/libfb.so
    [  2739.984] (II) Module fb: vendor="X.Org Foundation"
    [  2739.984] 	compiled for 1.20.8, module version = 1.0.0
    [  2739.984] 	ABI class: X.Org ANSI C Emulation, version 0.4
    [  2739.984] (II) Loading sub module "wfb"
    [  2739.984] (II) LoadModule: "wfb"
    [  2739.984] (II) Loading /usr/lib/xorg/modules/libwfb.so
    [  2739.984] (II) Module wfb: vendor="X.Org Foundation"
    [  2739.984] 	compiled for 1.20.8, module version = 1.0.0
    [  2739.984] 	ABI class: X.Org ANSI C Emulation, version 0.4
    [  2739.984] (II) Loading sub module "ramdac"
    [  2739.984] (II) LoadModule: "ramdac"
    [  2739.984] (II) Module "ramdac" already built-in
    [  2739.986] (**) NVIDIA(0): Depth 24, (--) framebuffer bpp 32
    [  2739.986] (==) NVIDIA(0): RGB weight 888
    [  2739.986] (==) NVIDIA(0): Default visual is TrueColor
    [  2739.986] (==) NVIDIA(0): Using gamma correction (1.0, 1.0, 1.0)
    [  2739.986] (II) Applying OutputClass "nvidia" options to /dev/dri/card0
    [  2739.986] (**) NVIDIA(0): Option "AllowEmptyInitialConfiguration"
    [  2739.986] (**) NVIDIA(0): Enabling 2D acceleration
    [  2740.370] (--) NVIDIA(0): Valid display device(s) on GPU-0 at PCI:1:0:0
    [  2740.370] (--) NVIDIA(0):     CRT-0
    [  2740.370] (--) NVIDIA(0):     DFP-0
    [  2740.370] (--) NVIDIA(0):     DFP-1
    [  2740.370] (--) NVIDIA(0):     DFP-2
    [  2740.370] (--) NVIDIA(0):     DFP-3 (boot)
    [  2740.371] (II) NVIDIA(0): NVIDIA GPU GeForce GTX 675M (GF114) at PCI:1:0:0 (GPU-0)
    [  2740.371] (--) NVIDIA(0): Memory: 2097152 kBytes
    [  2740.371] (--) NVIDIA(0): VideoBIOS: 70.24.43.00.12
    [  2740.371] (II) NVIDIA(0): Detected PCI Express Link width: 16X
    [  2740.371] (--) NVIDIA(GPU-0): CRT-0: disconnected
    [  2740.372] (--) NVIDIA(GPU-0): CRT-0: 400.0 MHz maximum pixel clock
    [  2740.372] (--) NVIDIA(GPU-0):
    [  2740.372] (--) NVIDIA(GPU-0): DFP-0: disconnected
    [  2740.372] (--) NVIDIA(GPU-0): DFP-0: Internal TMDS
    [  2740.372] (--) NVIDIA(GPU-0): DFP-0: 165.0 MHz maximum pixel clock
    [  2740.372] (--) NVIDIA(GPU-0):
    [  2740.372] (--) NVIDIA(GPU-0): DFP-1: disconnected
    [  2740.372] (--) NVIDIA(GPU-0): DFP-1: Internal TMDS
    [  2740.372] (--) NVIDIA(GPU-0): DFP-1: 165.0 MHz maximum pixel clock
    [  2740.372] (--) NVIDIA(GPU-0):
    [  2740.372] (--) NVIDIA(GPU-0): DFP-2: disconnected
    [  2740.372] (--) NVIDIA(GPU-0): DFP-2: Internal DisplayPort
    [  2740.372] (--) NVIDIA(GPU-0): DFP-2: 480.0 MHz maximum pixel clock
    [  2740.372] (--) NVIDIA(GPU-0):
    [  2740.372] (--) NVIDIA(GPU-0): Seiko/Epson SAMSUNG173HT02-C01 (DFP-3): connected
    [  2740.372] (--) NVIDIA(GPU-0): Seiko/Epson SAMSUNG173HT02-C01 (DFP-3): Internal DisplayPort
    [  2740.372] (--) NVIDIA(GPU-0): Seiko/Epson SAMSUNG173HT02-C01 (DFP-3): 480.0 MHz maximum pixel clock
    [  2740.372] (--) NVIDIA(GPU-0):
    [  2740.373] (II) NVIDIA(0): Validated MetaModes:
    [  2740.373] (II) NVIDIA(0):     "DFP-3:1920x1080"
    [  2740.373] (II) NVIDIA(0): Virtual screen size determined to be 1920 x 1080
    [  2740.375] (--) NVIDIA(0): DPI set to (128, 124); computed from "UseEdidDpi" X config
    [  2740.375] (--) NVIDIA(0):     option
    [  2740.376] (II) NVIDIA: Using 6144.00 MB of virtual memory for indirect memory
    [  2740.376] (II) NVIDIA:     access.
    [  2740.378] (II) NVIDIA(0): ACPI: failed to connect to the ACPI event daemon; the daemon
    [  2740.378] (II) NVIDIA(0):     may not be running or the "AcpidSocketPath" X
    [  2740.378] (II) NVIDIA(0):     configuration option may not be set correctly.  When the
    [  2740.378] (II) NVIDIA(0):     ACPI event daemon is available, the NVIDIA X driver will
    [  2740.378] (II) NVIDIA(0):     try to use it to receive ACPI event notifications.  For
    [  2740.378] (II) NVIDIA(0):     details, please see the "ConnectToAcpid" and
    [  2740.378] (II) NVIDIA(0):     "AcpidSocketPath" X configuration options in Appendix B: X
    [  2740.378] (II) NVIDIA(0):     Config Options in the README.
    [  2740.399] (II) NVIDIA(0): Setting mode "DFP-3:1920x1080"
    [  2741.463] (==) NVIDIA(0): Disabling shared memory pixmaps
    [  2741.463] (==) NVIDIA(0): Backing store enabled
    [  2741.463] (==) NVIDIA(0): Silken mouse disabled
    [  2741.463] (==) NVIDIA(0): DPMS enabled
    [  2741.463] (II) Loading sub module "dri2"
    [  2741.463] (II) LoadModule: "dri2"
    [  2741.463] (II) Module "dri2" already built-in
    [  2741.463] (II) NVIDIA(0): [DRI2] Setup complete
    [  2741.463] (II) NVIDIA(0): [DRI2]   VDPAU driver: nvidia
    [  2741.463] (II) Initializing extension Generic Event Extension
    [  2741.463] (II) Initializing extension SHAPE
    [  2741.463] (II) Initializing extension MIT-SHM
    [  2741.463] (II) Initializing extension XInputExtension
    [  2741.463] (II) Initializing extension XTEST
    [  2741.463] (II) Initializing extension BIG-REQUESTS
    [  2741.463] (II) Initializing extension SYNC
    [  2741.463] (II) Initializing extension XKEYBOARD
    [  2741.463] (II) Initializing extension XC-MISC
    [  2741.464] (II) Initializing extension SECURITY
    [  2741.464] (II) Initializing extension XFIXES
    [  2741.464] (II) Initializing extension RENDER
    [  2741.464] (II) Initializing extension RANDR
    [  2741.464] (II) Initializing extension COMPOSITE
    [  2741.464] (II) Initializing extension DAMAGE
    [  2741.464] (II) Initializing extension MIT-SCREEN-SAVER
    [  2741.464] (II) Initializing extension DOUBLE-BUFFER
    [  2741.464] (II) Initializing extension RECORD
    [  2741.464] (II) Initializing extension DPMS
    [  2741.464] (II) Initializing extension Present
    [  2741.464] (II) Initializing extension DRI3
    [  2741.464] (II) Initializing extension X-Resource
    [  2741.464] (II) Initializing extension XVideo
    [  2741.464] (II) Initializing extension XVideo-MotionCompensation
    [  2741.464] (II) Initializing extension XFree86-VidModeExtension
    [  2741.464] (II) Initializing extension XFree86-DGA
    [  2741.464] (II) Initializing extension XFree86-DRI
    [  2741.464] (II) Initializing extension DRI2
    [  2741.464] (II) Initializing extension GLX
    [  2741.464] (II) Initializing extension GLX
    [  2741.464] (II) Indirect GLX disabled.
    [  2741.464] (II) Initializing extension NV-GLX
    [  2741.464] (II) Initializing extension NV-CONTROL
    [  2741.464] (II) Initializing extension XINERAMA
    [  2741.523] (II) config/udev: Adding input device Power Button (/dev/input/event2)
    [  2741.523] (**) Power Button: Applying InputClass "libinput keyboard catchall"
    [  2741.523] (II) LoadModule: "libinput"
    [  2741.523] (II) Loading /usr/lib/xorg/modules/input/libinput_drv.so
    [  2741.525] (II) Module libinput: vendor="X.Org Foundation"
    [  2741.525] 	compiled for 1.20.7, module version = 0.29.0
    [  2741.525] 	Module class: X.Org XInput Driver
    [  2741.525] 	ABI class: X.Org XInput driver, version 24.1
    [  2741.525] (II) Using input driver 'libinput' for 'Power Button'
    [  2741.525] (**) Power Button: always reports core events
    [  2741.525] (**) Option "Device" "/dev/input/event2"
    [  2741.525] (**) Option "_source" "server/udev"
    [  2741.526] (II) event2  - Power Button: is tagged by udev as: Keyboard
    [  2741.526] (II) event2  - Power Button: device is a keyboard
    [  2741.527] (II) event2  - Power Button: device removed
    [  2741.565] (**) Option "config_info" "udev:/sys/devices/LNXSYSTM:00/LNXPWRBN:00/input/input2/event2"
    [  2741.565] (II) XINPUT: Adding extended input device "Power Button" (type: KEYBOARD, id 6)
    [  2741.567] (II) event2  - Power Button: is tagged by udev as: Keyboard
    [  2741.567] (II) event2  - Power Button: device is a keyboard
    [  2741.568] (II) config/udev: Adding input device Video Bus (/dev/input/event3)
    [  2741.568] (**) Video Bus: Applying InputClass "libinput keyboard catchall"
    [  2741.568] (II) Using input driver 'libinput' for 'Video Bus'
    [  2741.568] (**) Video Bus: always reports core events
    [  2741.568] (**) Option "Device" "/dev/input/event3"
    [  2741.568] (**) Option "_source" "server/udev"
    [  2741.569] (II) event3  - Video Bus: is tagged by udev as: Keyboard
    [  2741.569] (II) event3  - Video Bus: device is a keyboard
    [  2741.569] (II) event3  - Video Bus: device removed
    [  2741.640] (**) Option "config_info" "udev:/sys/devices/LNXSYSTM:00/LNXSYBUS:00/PNP0A08:00/device:07/LNXVIDEO:00/input/input3/event3"
    [  2741.640] (II) XINPUT: Adding extended input device "Video Bus" (type: KEYBOARD, id 7)
    [  2741.641] (II) event3  - Video Bus: is tagged by udev as: Keyboard
    [  2741.641] (II) event3  - Video Bus: device is a keyboard
    [  2741.642] (II) config/udev: Adding input device Power Button (/dev/input/event1)
    [  2741.642] (**) Power Button: Applying InputClass "libinput keyboard catchall"
    [  2741.642] (II) Using input driver 'libinput' for 'Power Button'
    [  2741.642] (**) Power Button: always reports core events
    [  2741.642] (**) Option "Device" "/dev/input/event1"
    [  2741.642] (**) Option "_source" "server/udev"
    [  2741.643] (II) event1  - Power Button: is tagged by udev as: Keyboard
    [  2741.643] (II) event1  - Power Button: device is a keyboard
    [  2741.643] (II) event1  - Power Button: device removed
    [  2741.685] (**) Option "config_info" "udev:/sys/devices/LNXSYSTM:00/LNXSYBUS:00/PNP0C0C:00/input/input1/event1"
    [  2741.685] (II) XINPUT: Adding extended input device "Power Button" (type: KEYBOARD, id 8)
    [  2741.687] (II) event1  - Power Button: is tagged by udev as: Keyboard
    [  2741.687] (II) event1  - Power Button: device is a keyboard
    [  2741.687] (II) config/udev: Adding input device Lid Switch (/dev/input/event0)
    [  2741.687] (II) No input driver specified, ignoring this device.
    [  2741.687] (II) This device may have been added with another device file.
    [  2741.688] (II) config/udev: Adding input device HDA NVidia HDMI/DP,pcm=3 (/dev/input/event7)
    [  2741.688] (II) No input driver specified, ignoring this device.
    [  2741.688] (II) This device may have been added with another device file.
    [  2741.688] (II) config/udev: Adding input device HDA NVidia HDMI/DP,pcm=7 (/dev/input/event8)
    [  2741.688] (II) No input driver specified, ignoring this device.
    [  2741.688] (II) This device may have been added with another device file.
    [  2741.689] (II) config/udev: Adding input device HDA NVidia HDMI/DP,pcm=8 (/dev/input/event9)
    [  2741.689] (II) No input driver specified, ignoring this device.
    [  2741.689] (II) This device may have been added with another device file.
    [  2741.689] (II) config/udev: Adding input device HDA NVidia HDMI/DP,pcm=9 (/dev/input/event10)
    [  2741.689] (II) No input driver specified, ignoring this device.
    [  2741.689] (II) This device may have been added with another device file.
    [  2741.689] (II) config/udev: Adding input device SC-20FHL11146M: SC-20FHL11146M (/dev/input/event6)
    [  2741.689] (**) SC-20FHL11146M: SC-20FHL11146M: Applying InputClass "libinput keyboard catchall"
    [  2741.690] (II) Using input driver 'libinput' for 'SC-20FHL11146M: SC-20FHL11146M'
    [  2741.690] (**) SC-20FHL11146M: SC-20FHL11146M: always reports core events
    [  2741.690] (**) Option "Device" "/dev/input/event6"
    [  2741.690] (**) Option "_source" "server/udev"
    [  2741.691] (II) event6  - SC-20FHL11146M: SC-20FHL11146M: is tagged by udev as: Keyboard
    [  2741.691] (II) event6  - SC-20FHL11146M: SC-20FHL11146M: device is a keyboard
    [  2741.692] (II) event6  - SC-20FHL11146M: SC-20FHL11146M: device removed
    [  2741.765] (**) Option "config_info" "udev:/sys/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1.4/1-1.4:1.0/input/input18/event6"
    [  2741.765] (II) XINPUT: Adding extended input device "SC-20FHL11146M: SC-20FHL11146M" (type: KEYBOARD, id 9)
    [  2741.767] (II) event6  - SC-20FHL11146M: SC-20FHL11146M: is tagged by udev as: Keyboard
    [  2741.767] (II) event6  - SC-20FHL11146M: SC-20FHL11146M: device is a keyboard
    [  2741.768] (II) config/udev: Adding input device HDA Intel PCH Mic (/dev/input/event11)
    [  2741.768] (II) No input driver specified, ignoring this device.
    [  2741.768] (II) This device may have been added with another device file.
    [  2741.768] (II) config/udev: Adding input device HDA Intel PCH Headphone (/dev/input/event12)
    [  2741.768] (II) No input driver specified, ignoring this device.
    [  2741.768] (II) This device may have been added with another device file.
    [  2741.769] (II) config/udev: Adding input device AT Translated Set 2 keyboard (/dev/input/event4)
    [  2741.769] (**) AT Translated Set 2 keyboard: Applying InputClass "libinput keyboard catchall"
    [  2741.769] (II) Using input driver 'libinput' for 'AT Translated Set 2 keyboard'
    [  2741.769] (**) AT Translated Set 2 keyboard: always reports core events
    [  2741.769] (**) Option "Device" "/dev/input/event4"
    [  2741.769] (**) Option "_source" "server/udev"
    [  2741.770] (II) event4  - AT Translated Set 2 keyboard: is tagged by udev as: Keyboard
    [  2741.770] (II) event4  - AT Translated Set 2 keyboard: device is a keyboard
    [  2741.771] (II) event4  - AT Translated Set 2 keyboard: device removed
    [  2741.805] (**) Option "config_info" "udev:/sys/devices/platform/i8042/serio0/input/input4/event4"
    [  2741.805] (II) XINPUT: Adding extended input device "AT Translated Set 2 keyboard" (type: KEYBOARD, id 10)
    [  2741.807] (II) event4  - AT Translated Set 2 keyboard: is tagged by udev as: Keyboard
    [  2741.807] (II) event4  - AT Translated Set 2 keyboard: device is a keyboard
    [  2741.808] (II) config/udev: Adding input device ETPS/2 Elantech Touchpad (/dev/input/event13)
    [  2741.808] (**) ETPS/2 Elantech Touchpad: Applying InputClass "libinput touchpad catchall"
    [  2741.808] (II) Using input driver 'libinput' for 'ETPS/2 Elantech Touchpad'
    [  2741.808] (**) ETPS/2 Elantech Touchpad: always reports core events
    [  2741.808] (**) Option "Device" "/dev/input/event13"
    [  2741.808] (**) Option "_source" "server/udev"
    [  2741.810] (II) event13 - ETPS/2 Elantech Touchpad: is tagged by udev as: Touchpad
    [  2741.811] (II) event13 - ETPS/2 Elantech Touchpad: device is a touchpad
    [  2741.811] (II) event13 - ETPS/2 Elantech Touchpad: device removed
    [  2741.872] (**) Option "config_info" "udev:/sys/devices/platform/i8042/serio1/input/input16/event13"
    [  2741.872] (II) XINPUT: Adding extended input device "ETPS/2 Elantech Touchpad" (type: TOUCHPAD, id 11)
    [  2741.873] (**) Option "AccelerationScheme" "none"
    [  2741.873] (**) ETPS/2 Elantech Touchpad: (accel) selected scheme none/0
    [  2741.873] (**) ETPS/2 Elantech Touchpad: (accel) acceleration factor: 2.000
    [  2741.873] (**) ETPS/2 Elantech Touchpad: (accel) acceleration threshold: 4
    [  2741.874] (II) event13 - ETPS/2 Elantech Touchpad: is tagged by udev as: Touchpad
    [  2741.876] (II) event13 - ETPS/2 Elantech Touchpad: device is a touchpad
    [  2741.876] (II) config/udev: Adding input device ETPS/2 Elantech Touchpad (/dev/input/mouse0)
    [  2741.876] (II) No input driver specified, ignoring this device.
    [  2741.877] (II) This device may have been added with another device file.
    [  2741.877] (II) config/udev: Adding input device PC Speaker (/dev/input/event5)
    [  2741.877] (II) No input driver specified, ignoring this device.
    [  2741.877] (II) This device may have been added with another device file.
    [  2741.882] (--) NVIDIA(GPU-0): Seiko/Epson SAMSUNG173HT02-C01 (DFP-3): connected
    [  2741.882] (--) NVIDIA(GPU-0): Seiko/Epson SAMSUNG173HT02-C01 (DFP-3): Internal DisplayPort
    [  2741.882] (--) NVIDIA(GPU-0): Seiko/Epson SAMSUNG173HT02-C01 (DFP-3): 480.0 MHz maximum pixel clock
    [  2741.882] (--) NVIDIA(GPU-0):
    [  2746.687] (II) event2  - Power Button: device removed
    [  2746.712] (II) event3  - Video Bus: device removed
    [  2746.778] (II) event1  - Power Button: device removed
    [  2746.818] (II) event6  - SC-20FHL11146M: SC-20FHL11146M: device removed
    [  2746.885] (II) event4  - AT Translated Set 2 keyboard: device removed
    [  2746.912] (II) event13 - ETPS/2 Elantech Touchpad: device removed
    [  2749.726] (II) UnloadModule: "libinput"
    [  2749.726] (II) UnloadModule: "libinput"
    [  2749.726] (II) UnloadModule: "libinput"
    [  2749.726] (II) UnloadModule: "libinput"
    [  2749.726] (II) UnloadModule: "libinput"
    [  2749.726] (II) UnloadModule: "libinput"
    [  2749.773] (II) NVIDIA(GPU-0): Deleting GPU-0
    [  2749.774] (II) Server terminated successfully (0). Closing log file.

### Desktop Environment, Display Manager, Greeter

Once X is installed and can be initiated, it's time to install a desktop environment, e.g. `lxqt`, a display manager, e.g. `lxdm`, and a greeter, e.g. `lightdm-webkit-theme-litarvan`:

    pacman -S lxqt
    pacman -S lightdm-runit
    pacman -S --needed lightdm-webkit2-greeter lightdm-webkit-theme-litarvan

We need to tell the display manager about the greeter we want to use. For LightDM this is done in `/etc/lightdm/lightdm.conf` in the `[Seat:*]` section

    greeter-session=lightdm-webkit2-greeter

Now we need to tell Runit about our display manager:

    ln -s /etc/runit/sv/lightdm /run/runit/service/

If we are asked about the default Window Manager to use, we select `openbox` because it is the default windows manager of LightDM.

## Tools

### Hugo

Install hugo, but don't forget to add some helper scripts, e.g. in `/data/scripts`:

    # `hs` to start a hugo server
    /data/progs/hugo/bin/hugo server -D --bind 192.168.2.135 --disableFastRender --baseURL http://192.168.2.135/

    # `ti` to show tree of a hugo project but ignore the `themes` dir
    tree -I themes

## OMG what did I do

`sudo ln -s /etc/runit/sv /run/runit/service`, but I think everything is still fine, this had no effect

[grubboot]: https://askubuntu.com/a/1081138/901433
[supplicant]: https://wiki.archlinux.org/index.php/Wpa_supplicant
[connman]: https://wiki.archlinux.org/title/ConnMan#Enabling_and_disabling_WiFi
